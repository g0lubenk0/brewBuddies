{% extends 'base.html' %}

{% block content %}
  <h2>{{ group.name }} Chat</h2>

  <div id="chat-messages" class="mx-auto w-75 h-75" >
    <!-- Messages will be displayed here -->
  </div>

  <form id="chat-form" method="post">
    {% csrf_token %}
    <input type="text" id="message-input" placeholder="Type your message">
    <button type="submit">Send</button>
  </form>

  <script>
    const chatSocket = new WebSocket(
      'ws://' + window.location.host + '/ws/group/{{ group.id }}/'
    );

    chatSocket.onmessage = function (e) {
      const data = JSON.parse(e.data);
      const messageElement = document.createElement('p');
      messageElement.textContent = data.message;
      document.querySelector('#chat-messages').appendChild(messageElement);
    };

    document.querySelector('#chat-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const messageInputDom = document.querySelector('#message-input');
      const message = messageInputDom.value;
      chatSocket.send(JSON.stringify({ 'message': message }));
      messageInputDom.value = '';
    });
  </script>
{% endblock %}
